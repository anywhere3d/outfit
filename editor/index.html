<!DOCTYPE html>
<html>
<head>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <meta name="description" contents="{{description}}">
    <!-- link rel="manifest" href="/manifest.json" -->
    <title>Outfit Editor (index.html v1.1)</title>
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/bootbox-dialoges.css">
    <link rel="stylesheet" href="/css/side-panels.css">
    <link rel="stylesheet" href="/css/messg.css" >
    <link rel="stylesheet" href="/css/spectrum.css">
    <link rel="stylesheet" href="/css/colorpicker.css">
    <link rel="stylesheet" href="/css/spinner.css">
    <link rel="stylesheet" href="/css/jquery-ui.css">
    <link rel="stylesheet" href="/css/alerts.css">
    <link rel="stylesheet" href="/css/panel-ui.css">
    <link rel="stylesheet" href="/css/anywhere3d.css">
    <link rel="stylesheet" href="/css/joystick.css">
    <link rel="stylesheet" href="/css/jquery.Jcrop.css">
    <link rel="stylesheet" href="/css/menu-menubar.css">

                <!-- JQUERY -->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery-ui.js"></script>
    <script src="/js/jquery.Jcrop.js"></script>
    <script src="/js/jquery.lazy.js"></script>
    <script src="/js/jquery.lazy.plugins.js"></script>

    <script>
    
        debugMode = true;
        var jsFolder = "/js/";
        var navbarFolder = "/navbar/";
        var scriptsFolder = "/scripts/";
        var skinnedFolder  = "/skinned/";
        var componentsFolder = "/components/";
        var animationsFolder = "/animations/";
        $.ajaxSetup({ cache: false });
    
    </script>

</head>

<body>

<style>

    body { margin:0px; height:100vh; overflow:hidden; font-family: Arial, sans-serif; }
    canvas { display:block !important; }

    #body-section { 
        height:100%; padding-top:0px; padding-bottom:0px; 
        background-color:rgba(0,0,0,1); overflow:hidden; 
    }

    .navbar.navbar-default.navbar-fixed-top { background: -webkit-linear-gradient(#484646,#020202); }

    #render-container { 
        width:100%; height:100%; 
        opacity:1; background-color:rgb(0,0,0); 
    }

    #joystick1, #joystick2, #jumpButton  { z-index:0 !important; }

    .twitter-holder { text-align:center; margin:10px 0px; }    

    .menu-helpers a,
    .editor-helpers a,
    .mode-helpers a,
    .updater-helpers a,
    .helpers a { font:bold 16px Arial; cursor:pointer; text-decoration:none; }

    .ui-dialog { opacity:1 !important; }

    .left-slot, .right-slot { margin-bottom:10px; }
    .side-holder { width:84%; margin-bottom:10px; }    

    .modal-dialog {
        width:fit-content;
        max-width: 400px;
    }

</style>


<div id="navbar-holder" class="navbar navbar-default navbar-fixed-top"></div>


<section class="mbr-section" id="body-section">

    <div id="render-container" class="mbr-overlay"></div>

    <div class="joystick-controls" id="joystick-controls-1"></div>
    <div class="joystick-controls" id="joystick-controls-2"></div>

    <div class="side-panel" id="left-side">
        <div id="left-side-pinbtn" title="click this to pin/unpin panel"></div>


        <div id="left-side-content">

        <!-- 
            <div id="outfit-editor-male-holder">
                <h4>Male Outfit helpers:</h4>
                <li class="helpers" data-outfit="boxers"   data-asset="hmBoxers"      data-gender="male" data-remove="trousers,boxers"><a></a></li>
                <li class="helpers" data-outfit="tshirt"   data-asset="hmTshirt"      data-gender="male"><a></a></li>
                <li class="helpers" data-outfit="tshirt"   data-asset="hmTshirtStamp" data-gender="male"><a></a></li>
                <li class="helpers" data-outfit="trousers" data-asset="hmTrousers"    data-gender="male" data-remove="boxers" data-nudity="boxers"><a></a></li>
                <li class="helpers" data-outfit="shoes"    data-asset="hmSneakers"    data-gender="male"><a></a></li>
                <li class="helpers" data-outfit="hairs"    data-asset="hmHairs"       data-gender="male"><a></a></li>
                <li class="helpers" data-outfit="body"     data-asset="hmBody"        data-gender="male" data-remove="boxers" data-nudity="boxers"><a></a></li>
            </div>
            <hr/>
            <div id="outfit-editor-female-holder">
                <h4>Female Outfit helpers:</h4>
                <li class="helpers" data-outfit="bra"      data-asset="fmBra"         data-gender="female" data-remove="tshirt,dress"                      data-nudity="bra"><a></a></li>
                <li class="helpers" data-outfit="panties"  data-asset="fmPanties"     data-gender="female" data-remove="trousers,skirt,dress"              data-nudity="panties"><a></a></li>
                <li class="helpers" data-outfit="tshirt"   data-asset="fmTshirt"      data-gender="female" data-remove="bra,dress"                         data-nudity="bra"><a></a></li>
                <li class="helpers" data-outfit="tshirt"   data-asset="fmTshirtStamp" data-gender="female" data-remove="bra,dress"                         data-nudity="bra"><a></a></li>
                <li class="helpers" data-outfit="skirt"    data-asset="fmSkirt"       data-gender="female" data-remove="panties,trousers,dress"            data-nudity="panties"><a></a></li>
                <li class="helpers" data-outfit="trousers" data-asset="fmTrousers"    data-gender="female" data-remove="panties,skirt,dress"               data-nudity="panties"><a></a></li>
                <li class="helpers" data-outfit="dress"    data-asset="fmDress"       data-gender="female" data-remove="panties,trousers,skirt,bra,tshirt" data-nudity="bra,panties"><a></a></li>
                <li class="helpers" data-outfit="shoes"    data-asset="fmSandal"      data-gender="female"><a></a></li>
                <li class="helpers" data-outfit="hairs"    data-asset="fmHairs"       data-gender="female"><a></a></li>
                <li class="helpers" data-outfit="body"     data-asset="fmBody"        data-gender="female" data-remove="bra,panties"                       data-nudity="bra,panties"><a></a></li>
            </div>
         -->

            <div id="left-slot1-holder"></div>
            <div id="left-slot2-holder"></div>
            <div id="left-slot3-holder"></div>
            <div id="left-slot4-holder"></div>
            <div id="left-slot5-holder"></div>
            <div id="left-slot6-holder"></div>
            <div id="left-slot7-holder"></div>
            <div id="left-slot8-holder"></div>
            <div id="left-slot9-holder"></div>
            <div id="left-slot10-holder"></div>

            <div class="twitter-holder">
                <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-url="http://anywhere3d.com/" data-lang="en" data-show-count="false">Tweet</a>
                <a href="https://twitter.com/anywhere3d?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-show-screen-name="false" data-lang="en" data-show-count="false">Follow</a>
                <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
            </div>
            
            <div class="dna-share-holder" style="text-align:center;">
                <input type="button" id="dna-share-button" class="btn btn-default btn-white-outline" style="width:50%" value="Share">
                <script>
                    $("#dna-share-button").on("click", function(){
                        var dna = localPlayer.outfit.toDNA();
                        debugMode && console.log( "http://localhost:8888/preview/#" + dna );
                    });
                </script>
            </div>

        </div>
    </div>

    <div class="side-panel" id="right-side">
        <div id="right-side-pinbtn" title="click this to pin/unpin panel"></div>

        <div id="right-side-content">

            <div id="actions-holder">
                <li id="action-controls" class="menu-helpers"><a>Action Controls</a></li>
            </div>

            <div id="right-slot1-holder" class="side-holder"></div>
            <div id="right-slot2-holder" class="side-holder"></div>
            <div id="right-slot3-holder" class="side-holder"></div>
            <div id="right-slot4-holder" class="side-holder"></div>
            <div id="right-slot5-holder" class="side-holder"></div>
            <div id="right-slot6-holder" class="side-holder"></div>
            <div id="right-slot7-holder" class="side-holder"></div>
            <div id="right-slot8-holder" class="side-holder"></div>
            <div id="right-slot9-holder" class="side-holder"></div>
            <div id="right-slot10-holder" class="side-holder"></div>
            <div id="right-slot11-holder" class="side-holder"></div>
            <div id="right-slot12-holder" class="side-holder"></div>

        </div>
    </div>

</section>

        <!-- SOCKETCLUSTER -->

<script src="/js/socketcluster.js"></script>
<script src="/js/sc-codec-min-bin.js"></script>


       <!-- INFLATE - DEFLATE -->

<script src="/js/rawinflate.js"></script>
<script src="/js/rawdeflate.js"></script>
<script src="/scripts/encode.js"></script>
<script src="/scripts/decode.js"></script>

            <!-- ZARGODB -->

<script src="/js/zangodb.min.js"></script>
<script src="/js/anywheredb.js"></script>

         <!-- LOCAL STORAGE -->

<script src="/js/store2.js"></script>
<script src="/js/store.on.js"></script>
<script src="/js/store.array.js"></script>

        <!-- LOCAL FORAGE -->

<script src="/js/localforage.js"></script>

<script>

    var CacheStorage = localforage.createInstance({
        driver: localforage.INDEXEDDB,
        name: "anywhere3d",
        storeName: "cache",
        version: 1.0
    });

    CacheStorage.ready().then(function() {
        console.log("[CacheStorage ready]:", CacheStorage.driver()); // <-- asyncStorage
    }).catch(function (err) {
        console.error("[CacheStorage Error]:", err); 
    });

</script>

               <!-- W3 -->

<script src="/js/w3.js"></script>

          <!-- USER SETTINGS -->

<script src="/js/userSettings.js"></script>

        <!-- LIBRARIES -->

<script src="/js/validator.min.js"></script>
<script async src="/js/alerts.js"></script>
<script async src="/js/bootbox.min.js"></script>
<script async src="/js/bootstrap.min.js"></script>
<script async src="/js/DeviceDetector.js"></script>
<script async src="/js/MathDecimalAdjustment.js"></script>
<script async src="/js/html2canvas.js"></script>
<script async src="/js/spectrum.js"></script>
<script async src="/js/watermark.js"></script>
<script async src="/js/sharer.js"></script>
<script async src="/js/helpers.js"></script>
<script async src="/js/side-panels.js"></script>

        <!-- THREEJS -->

<script src="/three/three.js"></script>
<script src="/three/EditorControls.js"></script>
<script src="/three/Detector.js"></script>
<script src="/three/Projector.js"></script>
<script src="/three/Animation.js"></script>
<script src="/three/AnimationHandler.js"></script>
<script src="/three/KeyFrameAnimation.js"></script>
<script src="/js/shader.js"></script>

<script>
    THREE.Cache.enabled = true;
    THREE.Texture.DEFAULT_IMAGE = "https://i.imgur.com/8eycYxu.png";
</script>

       <!-- MESHWALK -->

<script src="/js/MW.js"></script>
<script src="/js/MWtps.js"></script>
<script src="/js/VirtualInput.js"></script>

        <!-- SCENE -->

<script src="/js/scene-helpers.js"></script>

<script>

//  scene.js

    var debugMode;

    var fontFolder = "/three/fonts/";
    var fontPath = fontFolder + "helvetiker_regular.typeface.json";
    var sceneContainerSelector = "#render-container";
    var container = $(sceneContainerSelector)[0];

    var scene, 
        camera, 
        renderer, 
        controls;

    var sceneLights, 
        axisCustomHelper, 
        axisOriginHelper;

    var projector, 
        keyboard, 
        clock;

    var scenename = "Webspaces";

    scene = new THREE.Scene();
    scene.name = scenename;

    camera = new FpsCamera(50, 1, 10000);
    camera.position.set(0, 20, 100);
//  controls = new THREE.EditorControls(camera);

    scene.add(directionalLight(0xffffff,  1000, 1000,  1000, 0.5));
    scene.add(directionalLight(0xffffff,  1000, 1000, -1000, 0.5)); 
    scene.add(directionalLight(0xffffff, -1000, 1000,  1000, 0.5)); 
    scene.add(directionalLight(0xffffff, -1000, 1000, -1000, 0.5));
    scene.add(directionalLight(0xffffff,     0,-5000,     0, 0.3));

    groundHelper = new GroundHelper(1000, 10);  
    groundHelper.visible = false;
    axisCustomHelper = new CustomAxisHelper(5200);
    axisCustomHelper.visible = false;
    axisOriginHelper = new OriginAxisHelper(1200);
    axisOriginHelper.visible = false;

    projector = new THREE.Projector();
//  keyboard = new KeyboardState();
    clock = new THREE.Clock();

    renderer = new THREE.WebGLRenderer({
        antialias: true,
        preserveDrawingBuffer: true,
    });

    renderer.shadowMap.enabled = true;
    renderer.setPixelRatio( window.devicePixelRatio );
//  renderer.setSize( window.innerWidth, window.innerHeight );
    renderer.setSize( container.clientWidth, container.clientHeight );
    container.appendChild( renderer.domElement );

</script>

<script>

//  MW world.js

    var world, groundBody;

//  MESHWALK WORLD.

    world = new MW.World();

//  OCTREE.

//  Make a octree object, which will be the 
//  container of rigid objects such as terrain ect.
    partition = 5;
    min = new THREE.Vector3( -5000, -1000, -5000 );
    max = new THREE.Vector3(  5000,  1000,  5000 );
    octree = new MW.Octree( min, max, partition );
    world.add( octree );

//  Ground.
    var ground = new THREE.Mesh(
        new THREE.PlaneGeometry( 6000, 6000, 1, 1 ),
        new THREE.MeshBasicMaterial({ 
            color:0x888888,
            transparent:true,
            opacity:0.5, 
            wireframe:false 
        })
    );
    ground.rotation.x = THREE.Math.degToRad( -90 ); // -Math.PI/2

//  We want the ground as collision surface only,
//  so we do not add the ground in the scene.
//  scene.add( ground );

//  Add the ground to WALKMESH world octree object.
//  MESHWALK use octree system to detect collision objects.
    octree.importThreeMesh( ground ); // IMPORTANT //

</script>

<script src="/js/EdgesHelper.js"></script>

        <!-- AW3D -->

<script src="/js/AW3D.js"></script>
<script src="/js/PlayerController.js"></script>
<script src="/js/KeyInputControls.js"></script>
<script src="/js/JoystickControls.js"></script>

<script src="/js/PlayerLabel.js"></script>

<script src="/js/OutfitLoader.js"></script>
<script src="/js/loaders/bonesLoader.js"></script>
<script src="/js/loaders/animationsLoader.js"></script>

<script async src="/js/loaders/fmBodyLoader.js"></script>
<script async src="/js/loaders/fmHairsLoader.js"></script>
<script async src="/js/loaders/fmDressLoader.js"></script>
<script async src="/js/loaders/fmSandalShoesLoader.js"></script>
<script async src="/js/loaders/fmBraLoader.js"></script>
<script async src="/js/loaders/fmPantiesLoader.js"></script>
<script async src="/js/loaders/fmSkirtLoader.js"></script>
<script async src="/js/loaders/fmSneakersLoader.js"></script>
<script async src="/js/loaders/fmTailDressLoader.js"></script>
<script async src="/js/loaders/fmTrousersLoader.js"></script>
<script async src="/js/loaders/fmTshirtLoader.js"></script>

<script async src="/js/loaders/hmBodyLoader.js"></script>
<script async src="/js/loaders/hmHairsLoader.js"></script>
<script async src="/js/loaders/hmTshirtLoader.js"></script>
<script async src="/js/loaders/hmTrousersLoader.js"></script>
<script async src="/js/loaders/hmBoxersLoader.js"></script>
<script async src="/js/loaders/hmSneakersLoader.js"></script>


    <!-- COMPONENTS -->

<script>
//  navbar-outfit-editor.html
    var navbarHolderSelector = "#navbar-holder";
    var navbarComponent = navbarFolder + "navbar-outfit-editor.html";
    $(navbarHolderSelector).load(navbarComponent, function(response, status, xhr){
        debugMode && console.log("navbar-outfit-editor:", status);
    });
</script>

<script>
/*
//  outfit-helpers.html
    var outfitHelpersHolderSelector = "#left-slot1-holder";
    var outfitHelpersComponent = componentsFolder + "outfit-helpers.html";
    $(outfitHelpersHolderSelector).load(outfitHelpersComponent, function(response, status, xhr){
        debugMode && console.log("outfit-helpers:", status);
    });
*/
</script>

<script>
//  fabric-texture-catalog-button.html
    var fabricTextureCatalogHolderSelector = "#right-slot1-holder";
    var fabricTextureCatalogButtonComponent = componentsFolder + "fabric-texture-catalog-button.html";
    $(fabricTextureCatalogHolderSelector).load(fabricTextureCatalogButtonComponent, function(response, status, xhr){
        debugMode && console.log("fabric-texture-catalog-button:", status);
    });
</script>

<script>
//  outfit-panties-catalog-button.html
    var pantiesCatalogHolderSelector = "#right-slot2-holder";
    var pantiesCatalogButtonComponent = componentsFolder + "outfit-panties-catalog-button.html";
    $(pantiesCatalogHolderSelector).load(pantiesCatalogButtonComponent, function(response, status, xhr){
        debugMode && console.log("outfit-panties-catalog-button:", status);
    });
</script>

<script>
//  outfit-bra-catalog-button.html
    var braCatalogHolderSelector = "#right-slot3-holder";
    var braCatalogButtonComponent = componentsFolder + "outfit-bra-catalog-button.html";
    $(braCatalogHolderSelector).load(braCatalogButtonComponent, function(response, status, xhr){
        debugMode && console.log("outfit-bra-catalog-button:", status);
    });
</script>

<script>
//  outfit-tshirt-catalog-button.html
    var tshirtCatalogHolderSelector = "#right-slot4-holder";
    var tshirtCatalogButtonComponent = componentsFolder + "outfit-tshirt-catalog-button.html";
    $(tshirtCatalogHolderSelector).load(tshirtCatalogButtonComponent, function(response, status, xhr){
        debugMode && console.log("outfit-tshirt-catalog-button:", status);
    });
</script>

<script>
//  tshirt-stamp-catalog-button.html
    var tshirtStampCatalogHolderSelector = "#right-slot5-holder";
    var tshirtStampCatalogButtonComponent = componentsFolder + "tshirt-stamp-catalog-button.html";
    $(tshirtStampCatalogHolderSelector).load(tshirtStampCatalogButtonComponent, function(response, status, xhr){
        debugMode && console.log("tshirt-stamp-catalog-button:", status);
    });
</script>

<script>
//  outfit-dress-catalog-button.html
    var dressCatalogHolderSelector = "#right-slot6-holder";
    var dressCatalogButtonComponent = componentsFolder + "outfit-dress-catalog-button.html";
    $(dressCatalogHolderSelector).load(dressCatalogButtonComponent, function(response, status, xhr){
        debugMode && console.log("outfit-dress-catalog-button:", status);
    });
</script>

<script>
//  outfit-trousers-catalog-button.html
    var trousersCatalogHolderSelector = "#right-slot7-holder";
    var trousersCatalogButtonComponent = componentsFolder + "outfit-trousers-catalog-button.html";
    $(trousersCatalogHolderSelector).load(trousersCatalogButtonComponent, function(response, status, xhr){
        debugMode && console.log("outfit-trousers-catalog-button:", status);
    });
</script>

<script>
//  outfit-skirt-catalog-button.html
    var skirtCatalogHolderSelector = "#right-slot8-holder";
    var skirtCatalogButtonComponent = componentsFolder + "outfit-skirt-catalog-button.html";
    $(skirtCatalogHolderSelector).load(skirtCatalogButtonComponent, function(response, status, xhr){
        debugMode && console.log("outfit-skirt-catalog-button:", status);
    });
</script>

<script>

//  texture-target-map-options-button.html
    var targetMapOptionsHolderSelector = "#right-slot9-holder";
    var targetMapOptionsButtonComponent = componentsFolder + "texture-target-map-options-button.html";
    $(targetMapOptionsHolderSelector).load(targetMapOptionsButtonComponent, function(response, status, xhr){
        debugMode && console.log("texture-target-map-options-button:", status);
    });

</script>

<script>

//  avatar-catalog-button.html
    var avatarCatalogHolderSelector = "#right-slot10-holder";
    var avatarCatalogButtonComponent = componentsFolder + "avatar-catalog-button.html";
    $(avatarCatalogHolderSelector).load(avatarCatalogButtonComponent, function(response, status, xhr){
        debugMode && console.log("avatar-catalog-button:", status);
    });

</script>

<script>
/*
//  outfit-editor-button.html
    var outfitEditorHolderSelector = "#right-slot5-holder";
    var outfitEditorButtonComponent = componentsFolder + "outfit-editor-button.html";
    $(outfitEditorHolderSelector).load(outfitEditorButtonComponent, function(response, status, xhr){
        debugMode && console.log("outfit-editor-button:", status);
    });
*/
</script>


<script>
/*
//  avatar-upload-button.html
    var avatarUploadHolderSelector = "#right-slot9-holder";
    var avatarUploadButtonComponent = componentsFolder + "avatar-upload-button.html";
    $(avatarUploadHolderSelector).load(avatarUploadButtonComponent, function(response, status, xhr){
        debugMode && console.log("avatar-upload-button:", status);
    });
*/
</script>

<script>
//  snapshot-crop-button.html
    var snapshotHolderSelector = "#right-slot12-holder";
    var snapshotCropButtonComponent = componentsFolder + "snapshot-crop-button.html";
    $(snapshotHolderSelector).load(snapshotCropButtonComponent, function(response, status, xhr){
        debugMode && console.log("snapshot-crop-button:", status);
    });
</script>

<script>
/*
//  Get parent.
//  source: "https://stackoverflow.com/questions/1789892/access-parent-object-in-javascript"

//  Initialize helpers.
    $("[data-gender]").toArray().forEach( function( item, i ){
        var gender = $(item).data("gender");
        var name = $(item).data("outfit");
        if ( !!localPlayer.outfit[ name ] ) {
            $(item).find("a").text(["Remove", gender, name].join(" "));
        } else {
            $(item).find("a").text(["Add", gender, name].join(" "));
        }
    });

    scene.add( localPlayer.outfit.direction );
    console.log("direction added.");

    $("[data-outfit]").on("click", outfitHelperClickHandler);

    function outfitHelperClickHandler(){

        var self = this;

        var gender = $(self).data("gender");  // IMORTANT //
        var asset  = $(self).data("asset");
        var outfit = $(self).data("outfit");

        var remove = $(self).data("remove");
    //  debugMode && console.log( "remove:", remove );
        if ( !!remove ) {
            remove = remove.split(",");
            debugMode && console.log( "remove:", remove );
        }

        var nudity = $(self).data("nudity");
    //  debugMode && console.log( "nudity:", nudity );
        if ( !!nudity ) {
            nudity = nudity.split(",");
            debugMode && console.log( "nudity:", nudity );
        }

        var string = "gender: %s, outfit: %s, asset: %s, remove: %o nudity: %o";
        debugMode && console.log( string, gender, outfit, asset, remove, nudity );

    //  Set gender.
        if ( !localPlayer.outfit.getGender(gender) ){
            localPlayer.outfit.removeAll();
            localPlayer.outfit.setGender(gender);
        }

    //  Removed items.
        if ( !!remove && remove.length > 0 ) {
            remove.forEach( function( name, i ){
                if ( !!localPlayer.outfit[ name ]) {
                    localPlayer.outfit.remove( name );
                }
            });
        }

    //  Add/Remove outfit item.
        if ( !localPlayer.outfit[ outfit ] ) {

        //  Add outfit item.
            localPlayer.outfit.add( {[ outfit ]: Avatars[ asset ]} );
        //  $(self).find("a").text("Remove outfit " + outfit);

        //  Define as target material.
            target = localPlayer.outfit[ outfit ].material.materials[0];

        } else {

        //  Remove outfit item.        
            localPlayer.outfit.remove( outfit );

        //  Nudity nudity.
            if ( !!localPlayer.outfit.body ) {
                if ( !!nudity && nudity.length > 0 ) {
                    nudity.forEach( function( outfit, i ){
                        var selector = [ "[", "data-outfit", "=", "'", outfit, "'", "]" ].join("");
                        var element = $(selector).toArray()[0];
                    //  debugMode && console.log( "addon element:", element );
                        var asset = $(element).data("asset");
                        localPlayer.outfit.add( {[ outfit ]: Avatars[ asset ]} );
                    });
                }
            }

        //  Undefine target.
        //  target = undefined;

        }

        debugMode && console.log( "target:", !!target );

    //  Update helpers text.
        if ( $(self).data("gender") == "male" ){
            $("[data-gender=male]").toArray().forEach( function( item, i ){
                var name = $(item).data("outfit");
                if ( !!localPlayer.outfit[ name ] ) {
                    $(item).find("a").text(["Remove", gender, name].join(" "));
                } else {
                    $(item).find("a").text(["Add", gender, name].join(" "));
                }
            });
            $("[data-gender=female]").toArray().forEach( function( item, i ){
                var name = $(item).data("outfit");
                $(item).find("a").text(["Add", "female", name].join(" "));
            });
        }

        if ( $(self).data("gender") == "female" ){
            $("[data-gender=female]").toArray().forEach( function( item, i ){
                var name = $(item).data("outfit");
                if ( !!localPlayer.outfit[ name ] ) {
                    $(item).find("a").text(["Remove", gender, name].join(" "));
                } else {
                    $(item).find("a").text(["Add", gender, name].join(" "));
                }
            });
            $("[data-gender=male]").toArray().forEach( function( item, i ){
                var name = $(item).data("outfit");
                $(item).find("a").text(["Add", "male", name].join(" "));
            });
        }
    }
*/
</script>

    <!-- RUNTIME ENGINE -->

<script src="/js/jquery-update-engine.js"></script>
<script src="/js/jquery-render-engine.js"></script>

<script>

//  app.js

    var debugMode;
    var mouse = new THREE.Vector2();

    var rendererHalfWidth = renderer.domElement.width * 0.5;
    var rendererHalfHeight = renderer.domElement.height * 0.5;

    localPlayer.holder.visible = false;
    localPlayer.controller.center.set(0,1,0);
    localPlayer.controller.direction = Math.PI;

//  Background.
    scene.background = new THREE.Color(0,0,0);


//  Animate.

    animate();

    function animate(){

        windowAnimationFrameRequestID = requestAnimationFrame( animate );

        render();

        update();

    }


//  Event Listeners.

    $(window).on( "resize", onWindowResize );

    function onWindowResize() {
        camera.aspect = container.clientWidth / container.clientHeight;
        camera.updateProjectionMatrix();
        renderer.setSize( container.clientWidth, container.clientHeight );
        rendererHalfWidth = renderer.domElement.width * 0.5;
        rendererHalfHeight = renderer.domElement.height * 0.5;
    }

    $(window).on( "mousemove", onMouseMove );

    function onMouseMove( event ) {
        mouse.x = ( event.clientX - rendererHalfWidth );
        mouse.y = ( event.clientY - rendererHalfHeight );
    }


//  action-controls.html

    var actionHolderSelector = "#actions-holder";
    var actionControlsSelector = "#action-controls";
    var actionControlsComponent = componentsFolder + "action-controls.html";
    $(actionHolderSelector).load(actionControlsComponent, function(response, status, xhr){
        debugMode && console.log("action-controls:", status);
    });

</script>

<script>

//  windowUrlDnaHash.js (v1.0)

	window.URL = window.URL || window.webkitURL;

	if ( window.location.hash ) {
        var hash = window.location.hash.substr( 1 );
        debugMode && console.log( "hash:", hash );
        localPlayer.outfit.fromDNA( hash );
        scene.add( localPlayer.outfit.direction );
	}

</script>

<script src="/js/editor-panel.js"></script>
<script src="/js/snapshot-panel.js"></script>
<script src="/js/dialogTargetEventListeners.js"></script>

</body>
</html>


<script>
/*
//  Gender.
    var female = {};
    female.body = {};

//  Fullbody
    female.body.hairs = {};
    female.body.dress ={};
    female.body.shoes = {};
//  Upperbody
    female.body.bra = {};
    female.body.bra.tshirt = {};
//  Lowerbody
    female.body.panties = {};
    female.body.panties.skirt = {};
    female.body.panties.trousers = {};
*/

/*
//  Gender.
    var male = {}; 
    male.body = {};
//  Fullbody
    male.body.hairs = {};
    male.body.shoes = {};
//  Upperbody
    male.body.tshirt = {};
//  Lowerbody
    male.body.boxers = {};
    male.body.boxers.trousers = {};
*/

</script>

<script>
/*
    function $loadOutfit(options){

        var url  = options.url;
        var key  = options.key;
        var name = options.name;
        var loadTexture0 = options.loadTexture;
        var loadTexture1 = options.loadTexture1;
        var loadTexture2 = options.loadTexture2;
        var loadTexture3 = options.loadTexture3;

        var jqxhr = $.getJSON( url ).then(function(json){

            json.sourceFile = url;  //  IMPORTANT  //

            var avatar = initSkinnedAsset( json, url );
            if ( !avatar.geometry.sourceFile ) {
                avatar.geometry.sourceFile = url; //  IMPORTANT  //
            }

        //  Up to 4 materials.
            if ( !!loadTexture0 ) loadTexture0( avatar );
            if ( !!loadTexture1 ) loadTexture1( avatar );
            if ( !!loadTexture2 ) loadTexture2( avatar );
            if ( !!loadTexture3 ) loadTexture3( avatar );

            return avatar;
        })

        jqxhr.done(function( avatar ){
            console.log( avatar );
            return avatar;
        });

        jqxhr.fail(function(err){
            console.error(err);
            throw  err;
        });

    }

    function femaleBodyLoader(){

        var options = {
            name: "fmBody",
            key : "fmBody",
            url : skinnedFolder + "HF_BodyLayer_ABK04_v02.js",
            loadTexture: function ( asset ){
            //  Female body map options.
                var mapOptions = {
                    id   : "pRYCYkb",
                    ext  : "jpg",
                    map  : "map",
                    name : "HF_Skin_SemiDark_v1",
                    asset: asset,
                    index: 0, // multimaterial index.
                    quality: "original",
                };
                mapOptions.url = imgurQualityUrl( mapOptions );
                textureMapLoader( mapOptions );
            //  Female body emissive map options.
                var emissOptions = {
                    id   : "jc8chBX",
                    ext  : "jpg",
                    map  : "emissiveMap",
                    name : "HF_Skin_Mid",
                    asset: asset,
                    index: 0, // multimaterial index.
                    quality: "original",
                };
                emissOptions.url = imgurQualityUrl( emissOptions );
                textureMapLoader( emissOptions );

                var index = mapOptions.index;
                asset.material.materials[ index ].metalness = 0;
                asset.material.materials[ index ].roughness = 0.6;
                asset.material.materials[ index ].displacementBias = 0;
                asset.material.materials[ index ].displacementScale = 0;
                asset.material.materials[ index ].color.setHex(0xffffff);
                asset.material.materials[ index ].emissive.setHex(0xb3b2b2);
            },
            
            loadTexture1: function ( asset ){
                var eyesOptions = {
                    id   : "Si5QWl0",
                    ext  : "png",
                    map  : ["map", "emissiveMap"],
                    name : "HF_Eyes",
                    asset: asset,
                    index: 1, // multimaterial index.
                    quality: "original",
                };
                eyesOptions.url = imgurQualityUrl( eyesOptions );
                var url   = eyesOptions.url;
                var name  = eyesOptions.name;
                var index = eyesOptions.index;

                var img = new Image();
                img.crossOrigin = "anonymous";
                $(img).one("load", function (){
                    var texture = new THREE.Texture( img ); // or canvas //
                    texture.name = name;
                    texture.sourceFile = url;
                    eyesOptions.map.forEach( function( name, i ){
                        applyTexture( asset, texture, name, index );
                    });
                    $(img).remove();
                });
        
                img.src = url;
        
            //  Material settings.
                asset.material.materials[ index ].bumpScale = 0;
                asset.material.materials[ index ].displacementBias = 0;
                asset.material.materials[ index ].displacementScale = 0;
                asset.material.materials[ index ].color.setHex(0xffffff);
                asset.material.materials[ index ].emissive.setHex(0x8d8d8d);

            },
        };

        return $loadOutfit( options );
    
    }
*/
</script>

<script>

/*
    var male = {
        init: function(){
        //  this.self = this;
            this.body     = {parent: this};
            this.hairs    = {parent: "body"};
            this.shoes    = {parent: "body"};
            this.tshirt   = {parent: "body"};
            this.boxers   = {parent: "body"};
            this.trousers = {parent: "boxers"};
            delete this.init;   // if you don't need the Init method anymore after the you instanced the object you can remove it.
            return this;        // it gives back the object itself to instance it.
        }
    }.init(); 
    console.log("male:", male );

    female = {
        init: function(){
        //  this.self = this;
            this.body     = {parent: this};  // femaleBodyLoader();
            this.bra      = {parent: "body"};
            this.hairs    = {parent: "body"};
            this.dress    = {parent: "body"};
            this.shoes    = {parent: "body"};
            this.panties  = {parent: "body"};
            this.tshirt   = {parent: "bra"};
            this.skirt    = {parent: "panties"};
            this.trousers = {parent: "panties"};
            delete this.init;   // if you don't need the Init method anymore after the you instanced the object you can remove it.
            return this;        // it gives back the object itself to instance it.
        }
    }.init();
    console.log("female:", female );
*/
/*
//  Get parent.
//  source: "https://stackoverflow.com/questions/1789892/access-parent-object-in-javascript"

    scene.add( localPlayer.outfit.direction );
    console.log("direction added.");

//  Initialize helpers.
    $("[data-gender]").toArray().forEach( function( item, i ){
        var gender = $(item).data("gender");
        var name = $(item).data("outfit");
        if ( !!localPlayer.outfit[ name ] ) {
            $(item).find("a").text(["Remove", gender, name].join(" "));
        } else {
            $(item).find("a").text(["Add", gender, name].join(" "));
        }
    });

    $("[data-gender]").on("click", function(){

        if ( localPlayer.outfit.getGender() != $(this).data("gender") ) {
            localPlayer.outfit.removeAll();
            localPlayer.outfit.setGender( $(this).data("gender") ); // IMPORTANT //
            localPlayer.outfit.AnimationsHandler.refresh();
        }

        var gender = localPlayer.outfit.getGender();
        console.log("gender:", gender );

        var outfit = $(this).data("outfit");
        var asset = $(this).data("asset");
        var parent = $(this).data("parent");

        console.log( "outfit:", outfit, "parent:", parent );

        if ( !localPlayer.outfit[ outfit ] ) {
            console.log( "outfit does not exist:", !localPlayer.outfit[ outfit ] );

            if ( !!parent ) localPlayer.outfit.remove( parent );

            localPlayer.outfit.add( {[outfit]: Avatars[ asset ]} );

        } else {
            console.log( "outfit does exist:", localPlayer.outfit[ outfit ] );

            localPlayer.outfit.remove( outfit );

            if ( !!parent ) {
                var selector = [ "[", "data-outfit", "=", "'", parent, "'", "]" ].join("");
                var parentAsset = $(selector).data("asset");
                console.log( "parentAsset:", parentAsset );
                localPlayer.outfit.add( {[parent]: Avatars[ parentAsset ]} );
            }
        }

    });
*/
</script>
